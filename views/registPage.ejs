<!doctype html>

<html lang="en">
  <script src="https://code.jquery.com/jquery-3.4.1.min.js" ></script>
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">

    <title>회원가입</title>
  </head>
  <%- include('nav.html')%>
  <script>
    $(document).ready(function(){
      // 아이디 중복체크
      $("#idDuplicateChk").on("click",function(){
        var userid = $("#id").val();
          $.ajax({
            method : 'SELECT'
            , url : '/member/idDuplicateChk'
            , data : {id : userid}
            , method : 'post'
          }).done(function(result){
            

           if(result=='Y'){
              // 중복된 아이디가 없을때
              alert("사용가능한 아이디입니다!");
              $("#duplicateResult").val("Y");
           }else{
              // 중복된 아이디가 존재할 때
              alert("이미 사용중인 아이디입니다!");
           }

         }).fail(function(xhr, textStatus, errorThrown){
            
            console.log(xhr, textStatus, errorThrown);
   
          });
      });

      // 회원가입
      $("#submit").on("click",function(){
        // 1.validChk
        if(!fnValidChk()){
          return false;
        }
        // 2. submit
        document.submitFrm.method='post';
        document.submitFrm.action='/member/regist';
      });
    });

    // validChk function
    function fnValidChk(){
        var duplicateResult = $("#duplicateResult").val();
        if(duplicateResult=='N'){
          alert("아이디를 중복체크하세요.");
          $("#id").focus();
          return false;
        }
        return true;
    }
  </script>
  <body>
      <div class="container mt-4">
        <input type="hidden" name="duplicateResult" id="duplicateResult" value="N">
        <form id="submitFrm" name="submitFrm" method="post">
        
          <div class="form-group">
              <p>아이디</p>
              <input type="text" id="id" class="form-control" name="id"/>
              <button type="button" id="idDuplicateChk" class="btn btn-secondary">중복체크</button>

          </div>
          <div class="form-group">
              <p>패스워드</p>
              <input type="password" class="form-control" name="pw"/>
          </div>
  
        <button type="submit" class="btn btn-danger" id="submit" value="Submit">회원가입</button>
        </form>
      </div>

  </body>
</html>
